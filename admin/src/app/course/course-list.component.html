<page [title]="'课程列表'" >

    <nz-breadcrumb  [style.marginBottom.px]="14">
        <nz-breadcrumb-item>
            首页
        </nz-breadcrumb-item>
        <nz-breadcrumb-item>
            <a routerLink='/backend/course'>课程</a>
        </nz-breadcrumb-item>
    </nz-breadcrumb>
    
    <nz-card nzTitle="课程列表">
        <nz-collapse [style.marginBottom.px]="24">
            <nz-collapse-panel [nzHeader]="'高级搜索'" [ngStyle]="{background: '#fafafa'}">
                <div nz-row [nzGutter]="16" >
                    <form nz-form>
                        <div nz-col class="gutter-row"  nzXl="24" nzXs="24" >
                            <div class="gutter-box">
                                <div nz-col class="gutter-row" nzXl="12" nzXs="12" >
                                    <nz-form-item>
                                        <nz-form-label [nzSm]="6" [nzXs]="24">标题</nz-form-label>
                                        <nz-form-control [nzSm]="14" [nzXs]="24">
                                            <input nz-input name="title" [(ngModel)]="searchData.title" (ngModelChange)="searchDataChange()" type="text">
                                        </nz-form-control>
                                    </nz-form-item>
                                </div>
                                <div nz-col class="gutter-row" nzXl="12" nzXs="12" >
                                    <nz-form-item>
                                        <nz-form-label [nzSm]="6" [nzXs]="24">讲师</nz-form-label>
                                        <nz-form-control [nzSm]="14" [nzXs]="24">
                                            <nz-select name="teacher_id" [(ngModel)]="searchData.teacher_id" (ngModelChange)="searchDataChange()" nzAllowClear>
                                                <nz-option *ngFor="let item of teachers" [nzValue]="item.id" [nzLabel]="item.name"></nz-option>
                                            </nz-select>
                                        </nz-form-control>
                                    </nz-form-item>
                                </div>
                                <div nz-col class="gutter-row" nzXl="12" nzXs="12" >
                                    <nz-form-item>
                                        <nz-form-label [nzSm]="6" [nzXs]="24">显示设备</nz-form-label>
                                        <nz-form-control [nzSm]="14" [nzXs]="24">
                                            <nz-radio-group name="show_type" [(ngModel)]="searchData.show_type" (ngModelChange)="searchDataChange()">
                                                <label nz-radio nzValue="all">全部</label>
                                                <label nz-radio nzValue="app">APP</label>
                                                <label nz-radio nzValue="mini">小程序</label>
                                            </nz-radio-group>
                                        </nz-form-control>
                                    </nz-form-item>
                                </div>
                                <div nz-col class="gutter-row" nzXl="12" nzXs="12" >
                                    <nz-form-item>
                                        <nz-form-label [nzSm]="6" [nzXs]="24">发布情况</nz-form-label>
                                        <nz-form-control [nzSm]="14" [nzXs]="24">
                                            <nz-radio-group name="status" [(ngModel)]="searchData.status" (ngModelChange)="searchDataChange()">
                                                <label nz-radio nzValue="active">已发布</label>
                                                <label nz-radio nzValue="inactive">未发布</label>
                                            </nz-radio-group>
                                        </nz-form-control>
                                    </nz-form-item>
                                </div>
                                <div nz-col class="gutter-row" nzXl="12" nzXs="12" >
                                    <nz-form-item>
                                        <nz-form-label [nzSm]="6" [nzXs]="24">课程分类</nz-form-label>
                                        <nz-form-control [nzSm]="14" [nzXs]="24">
                                            <nz-tree-select [nzNodes]="categorys" name="category_id" [(ngModel)]="searchData.category_id" (ngModelChange)="searchDataChange()" [nzDefaultExpandAll]="true">
                                            </nz-tree-select>
                                        </nz-form-control>
                                    </nz-form-item>
                                </div>
                                <div nz-col class="gutter-row" nzXl="12" nzXs="12" >
                                    <nz-form-item>
                                        <nz-form-label [nzSm]="6" [nzXs]="24">课程系列(待开发)</nz-form-label>
                                        <nz-form-control [nzSm]="14" [nzXs]="24">
                                            <nz-select nzDisabled>
                                                <nz-option nzValue="album" nzLabel="待开发"></nz-option>
                                            </nz-select >
                                        </nz-form-control>
                                    </nz-form-item>
                                </div>
                                <div nz-col class="gutter-row" nzXl="12" nzXs="12" >
                                    <nz-form-item>
                                        <nz-form-control [nzSpan]="14" [nzOffset]="6">
                                            <button  nz-button nzType="primary"  (click)="initData()">搜索</button>
                                            &nbsp; &nbsp;
                                            <button  nz-button  (click)="initSearch()">清空搜索</button>
                                        </nz-form-control>
                                    </nz-form-item>
                                </div>
            
                            </div>
                        </div>
                    </form>
                </div>
            </nz-collapse-panel>
        </nz-collapse>
        <div nz-row nzGutter="16" [style.marginBottom.px]="24">
            <div nz-col class="gutter-row" nzSpan="12">
                <div class="gutter-box">
                    <div>
                        <a class="ant-btn" routerLink='/backend/course/create'><i nz-icon type="plus"></i> 添加</a>
                        <a class="ant-btn" [style.marginLeft.px]="5"  (click)="initData()"> <i nz-icon type="redo"></i></a>
                    </div>
                </div>
            </div>
            <div nz-col class="gutter-row" nzPush="8" nzSpan="4">
                <div class="gutter-box">
                    <div [style.float]="'right'">
                        <nz-input-group [nzSuffix]="suffixIconSearch">
                            <input type="text" nz-input name="title" [(ngModel)]="searchData.title" (ngModelChange)="searchDataChange()" placeholder="搜索" />
                        </nz-input-group>
                        <ng-template #suffixIconSearch>
                            <i nz-icon type="search" (click)="initData()"></i>
                        </ng-template>
                    </div>
                </div>
            </div>
        </div>
        
        <nz-spin [nzSpinning]="isLoading">
        <nz-table nzBordered [nzData]="courses"  [nzShowPagination]="false" [style.marginBottom.px]="24">
            <thead (nzSortChange)="sortChange($event)" nzSingleSort>
                <tr>
                    <th><label nz-checkbox [nzIndeterminate]="indeterminate" [(ngModel)]="allChecked" (ngModelChange)="handleAllItem($event)"></label></th>
                    <th nzSortKey="c.id" nzShowSort>ID</th>
                    <th nzSortKey="p.title" nzShowSort>标题</th>
                    <th nzSortKey="c.courseCategory" nzShowSort>分类</th>
                    <th nzSortKey="c.teacher" nzShowSort>讲师</th>
                    <th nzSortKey="p.updatedAt" nzShowSort>操作时间</th>
                    <th>发布情况</th>
                    <th>操作</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let item of courses;let i = index">
                    <td><label nz-checkbox [ngModel]="courses[i].checked" (ngModelChange)="handleItem($event,item.id)"></label></td>
                    <td>{{item.id}}</td>
                    <td>{{item.title}}</td>
                    <td>{{item.category_title}}</td>
                    <td>{{item.teacher_name}}</td>
                    <td>{{item.update_at}}</td>
                    <td>
                        <nz-tag *ngIf="item.status == 'active'" [nzColor]="'#87d068'">已发布</nz-tag>
                        <nz-tag *ngIf="item.status != 'active'" [nzColor]="'#a9a9a9'">未发布</nz-tag>

                        <nz-tag *ngIf="item.is_single" [nzColor]="'#faad14'">单课程</nz-tag>
                        <nz-tag *ngIf="!item.is_single" [nzColor]="'#f98a8a'">系列课</nz-tag>

                        <nz-tag *ngIf="item.is_recommend" [nzColor]="'#ff8302'">推荐</nz-tag>
                        <nz-tag *ngIf="!item.is_recommend" [nzColor]="'#a9a9a9'">未推</nz-tag>

                        <nz-tag *ngIf="item.is_new" [nzColor]="'#ac83fd'">已最新</nz-tag>
                        <nz-tag *ngIf="!item.is_new" [nzColor]="'#a9a9a9'">未最新</nz-tag>
                    </td>
                    <td>
                        <nz-tag routerLink='/backend/course/create' [queryParams]="{'id':item.id}" [style.marginRight.px]="10"><i nz-icon type="form"></i> 编辑</nz-tag>
                        <nz-tag (click)="delListItem(item.id)"><i nz-icon type="delete"></i> 删除</nz-tag>
                    </td>
                </tr>
            </tbody>
        </nz-table>
        </nz-spin>

        <div nz-row nzGutter="16" [style.marginBottom.px]="24">
            <div nz-col class="gutter-row" nzSpan="12">
                <div class="gutter-box">
                    <div>
                        <nz-select name="action" [(ngModel)]="action" style="width:110px;" [style.marginRight.px]="2">
                            <nz-option *ngFor="let item of disposeOption" [nzValue]="item.value" [nzLabel]="item.title"></nz-option>
                        </nz-select>
                        <button nz-button (click)="disposeConfirm()" >操作</button>
                    </div>
                </div>
            </div>
            <div nz-col class="gutter-row" nzSpan="12">
                <div class="gutter-box">
                    <div [style.float]="'right'">
                        <nz-pagination (nzPageIndexChange)="nzPageIndexChange($event)" (nzPageSizeChange)="nzPageSizeChange($event)" [nzPageIndex]="page" nzShowSizeChanger [nzPageSize]="num" [nzTotal]="total_page*num"></nz-pagination>
                    </div>
                </div>
            </div>
        </div>
        
    </nz-card>
    
</page>
